@inherits LayoutComponentBase
@implements IDisposable
@using Microsoft.AspNetCore.Components.Authorization
@inject ConfirmDialogService Confirm

<div class="notion-app">
    <AuthorizeView>
        <Authorized>
            @* Lado izquierdo: Sidebar *@
            <aside class="notion-sidebar">
                <NavMenu />
            </aside>
            @* Lado derecho: Contenido *@
            <main class="notion-main">
                <div class="notion-content">
                    @Body
                </div>
            </main>
        </Authorized>
        <NotAuthorized>
            @* Pantalla completa para el Login *@
            <main style="width: 100%; height: 100vh;">
                @Body
            </main>
        </NotAuthorized>
    </AuthorizeView>
</div>

@* Modal fuera del contenedor principal para evitar conflictos con position fixed *@
<ConfirmDialog IsVisible="@Confirm.IsVisible"
               IsBusy="@Confirm.IsBusy"
               Title="@Confirm.Title"
               Message="@Confirm.Message"
               ConfirmButtonText="@Confirm.ConfirmButtonText"
               CancelButtonText="@Confirm.CancelButtonText"
               ErrorMessage="@Confirm.ErrorMessage"
               OnConfirm="@Confirm.ConfirmAsync"
               OnCancel="@Confirm.Cancel" />

@code {
    protected override void OnInitialized()
    {
        Confirm.OnChange += StateHasChanged;
    }

    public void Dispose()
    {
        Confirm.OnChange -= StateHasChanged;
    }
}