@using FacturacionVERIFACTU.Web.Services
@using FacturacionVERIFACTU.Web.Models.DTOs
@inject IAuthService AuthService
@inject NavigationManager Nav

<div class="notion-sidebar-header" style="padding: 20px 16px; border-bottom: 1px solid #edeceb;">
    <h3 style="font-weight: 700; font-size: 16px; margin-bottom: 4px;">Verifactu Pro</h3>
    @if (currentUser != null)
    {
        <p style="font-size: 12px; color: rgba(55,53,47,0.65);">@currentUser.NombreEmpresa</p>
    }
</div>

<nav class="flex-column" style="padding: 16px 0;">
    <NavLink class="nav-link" href="/" Match="NavLinkMatch.All">
        <i class="bi bi-house-door"></i>
        <span>Dashboard</span>
    </NavLink>

    <NavLink class="nav-link" href="/facturas">
        <i class="bi bi-receipt"></i>
        <span>Facturas</span>
    </NavLink>

    <NavLink class="nav-link" href="/clientes">
        <i class="bi bi-people"></i>
        <span>Clientes</span>
    </NavLink>

    <NavLink class="nav-link" href="/productos">
        <i class="bi bi-box-seam"></i>
        <span>Productos</span>
    </NavLink>

    <hr style="border-color: #edeceb; margin: 16px 12px;" />

    <a class="nav-link" @onclick="HandleLogout" style="cursor: pointer;">
        <i class="bi bi-box-arrow-right"></i>
        <span>Cerrar Sesión</span>
    </a>
</nav>

<div style="position: absolute; bottom: 20px; left: 16px; right: 16px;">
    @if (currentUser != null)
    {
        <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #f7f6f3; border-radius: 8px;">
            <div style="width: 32px; height: 32px; background: #000; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 14px;">
                @currentUser.NombreCompleto[0]
            </div>
            <div style="flex: 1; min-width: 0;">
                <div style="font-size: 13px; font-weight: 600; color: #37352f; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                    @currentUser.NombreCompleto
                </div>
                <div style="font-size: 11px; color: rgba(55,53,47,0.65); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                    @currentUser.Email
                </div>
            </div>
        </div>
    }
</div>

@code {
    private UserInfo? currentUser;

    protected override async Task OnInitializedAsync()
    {
        currentUser = await AuthService.GetCurrentUserAsync();
    }

    private async Task HandleLogout()
    {
        await AuthService.LogoutAsync();
        Nav.NavigateTo("/login", true);
    }
}